<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FC FLIPS PRO | Ultimate Trading Dashboard</title>
    
    <!-- External Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-darker: #000000;
            --bg-dark: #09090b;
            --bg-glass: rgba(20, 20, 25, 0.95);
            --accent-primary: #3b82f6;
            --accent-secondary: #06b6d4;
            --profit-color: #22c55e;
            --loss-color: #ef4444;
            --text-light: #e4e4e7;
        }

        /* --- GLOBAL LAYOUT --- */
        html { 
            background-color: var(--bg-darker); 
            height: 100%; 
            overflow-x: hidden; 
        }
        body {
            font-family: 'Poppins', sans-serif;
            background-color: transparent;
            color: var(--text-light);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
            position: relative;
        }

        /* Background FX */
        #bg-layer {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: -1;
            background-color: #000000;
            background-image: 
                linear-gradient(rgba(30, 30, 30, 0.5) 1px, transparent 1px), 
                linear-gradient(90deg, rgba(30, 30, 30, 0.5) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
        }
        #bg-anim {
            position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: radial-gradient(circle at 50% 50%, rgba(59, 130, 246, 0.05), transparent 40%);
            animation: pulse 10s ease-in-out infinite;
            pointer-events: none;
        }
        @keyframes pulse { 0%, 100% { transform: scale(1); opacity: 0.5; } 50% { transform: scale(1.1); opacity: 0.8; } }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-darker); }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--accent-primary); }

        /* --- COMPONENTS --- */
        .card {
            background: var(--bg-glass);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 1rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .card:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(0,0,0,0.2); border-color: rgba(59, 130, 246, 0.3); }

        .control-panel-container { position: relative; z-index: 40; } /* Lower than Header */
        .content-grid-container { position: relative; z-index: 10; }

        .btn {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white; font-weight: 600; border-radius: 0.5rem; padding: 0.6rem 1.5rem;
            transition: all 0.3s ease; border: none; cursor: pointer;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
            text-transform: uppercase; font-size: 0.85rem; letter-spacing: 0.5px;
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(59, 130, 246, 0.5); }
        .btn:active { transform: translateY(0); }
        
        .btn-secondary { background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); box-shadow: none; }
        .btn-secondary:hover { background: rgba(255, 255, 255, 0.1); border-color: white; }
        .btn-danger { background: linear-gradient(135deg, #ef4444, #b91c1c); box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3); }

        .modern-input, .auth-input {
            background: rgba(30, 30, 35, 0.6); border: 1px solid rgba(255, 255, 255, 0.1);
            color: white; border-radius: 0.5rem; padding: 0.75rem 1rem; width: 100%;
            transition: all 0.2s;
        }
        .modern-input:focus, .auth-input:focus { border-color: var(--accent-primary); outline: none; box-shadow: 0 0 0 1px var(--accent-primary); }

        /* --- DEAL CARDS --- */
        .deal-card { position: relative; overflow: hidden; transition: all 0.3s ease; }
        .deal-card:hover { transform: translateY(-5px); border-color: var(--accent-primary); box-shadow: 0 0 25px rgba(59, 130, 246, 0.15); }
        .deal-card.highlighted-card { border: 1px solid var(--profit-color); box-shadow: 0 0 20px rgba(34, 197, 94, 0.2); }
        .profit-positive { color: var(--profit-color); text-shadow: 0 0 10px rgba(34, 197, 94, 0.3); }
        .loss-negative { color: var(--loss-color); }

        /* --- DROPDOWNS --- */
        .custom-select-container { position: relative; width: 100%; min-width: 220px; }
        .custom-select-trigger {
            background: rgba(30, 30, 35, 1); border: 1px solid rgba(255, 255, 255, 0.1);
            color: white; border-radius: 0.5rem; padding: 0.75rem 1rem;
            display: flex; justify-content: space-between; align-items: center;
            cursor: pointer; transition: all 0.2s; font-size: 0.9rem;
        }
        .custom-select-trigger:hover { border-color: var(--accent-primary); }
        .custom-select-options {
            position: absolute; top: calc(100% + 0.5rem); left: 0; right: 0;
            background: #18181b; border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.5rem; z-index: 100; opacity: 0; visibility: hidden;
            transform: translateY(-10px); transition: all 0.2s cubic-bezier(0.16, 1, 0.3, 1);
            box-shadow: 0 10px 40px rgba(0,0,0,0.9); overflow: hidden;
        }
        .custom-select-container.open .custom-select-options { opacity: 1; visibility: visible; transform: translateY(0); }
        .custom-option {
            padding: 0.85rem 1rem; cursor: pointer; display: flex; align-items: center; gap: 0.75rem;
            border-bottom: 1px solid rgba(255,255,255,0.05); transition: background 0.2s;
        }
        .custom-option:hover { background: rgba(59, 130, 246, 0.15); }
        .custom-option:last-child { border-bottom: none; }
        .option-icon { width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; }
        .option-icon svg { width: 100%; height: 100%; }

        /* --- HEADER & PROFILE MENU --- */
        header { position: sticky; top: 0; z-index: 100; } /* Ensure Header is above everything */
        
        .profile-dropdown-container { position: relative; }
        .profile-dropdown-menu {
            position: absolute; right: 0; top: 110%; width: 16rem;
            background: #18181b; border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.75rem; box-shadow: 0 20px 40px -5px rgba(0, 0, 0, 0.7);
            opacity: 0; visibility: hidden; transform: translateY(-10px);
            transition: all 0.2s ease; z-index: 200; /* High Z-index to sit over control panel */
        }
        /* Open State Class */
        .profile-dropdown-menu.active { opacity: 1; visibility: visible; transform: translateY(0); }

        /* --- TAX CALCULATOR --- */
        #tax-calculator { 
            background: #0f1115; border: 1px solid rgba(59, 130, 246, 0.3); 
            border-radius: 0.75rem; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.8);
            transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1); overflow: hidden; z-index: 90;
        }
        #tax-calculator.minimized { transform: translateY(calc(100% - 46px)); }
        #tax-calculator:hover { border-color: var(--accent-primary); }
        .tax-input {
            background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1);
            color: white; text-align: right; font-family: monospace; font-size: 0.9rem; font-weight: bold;
            border-radius: 0.375rem; padding: 6px 10px; width: 100%;
        }
        .tax-input:focus { border-color: var(--accent-primary); outline: none; }

        /* --- ANIMATIONS & MODALS --- */
        .fade-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.9); backdrop-filter: blur(8px); z-index: 150; display: flex; align-items: center; justify-content: center; animation: fadeIn 0.2s; }
        .modal-content { background: #18181b; border: 1px solid rgba(255,255,255,0.1); border-radius: 1rem; width: 90%; max-width: 500px; padding: 2rem; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.7); animation: scaleIn 0.2s; }
        @keyframes scaleIn { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        /* --- TOAST --- */
        #alert-popup-container { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); z-index: 200; pointer-events: none; width: 100%; display: flex; flex-direction: column; align-items: center; gap: 10px; }
        .alert-popup {
            background-color: #10b981; color: white; padding: 12px 24px; border-radius: 99px;
            font-weight: 600; box-shadow: 0 10px 30px rgba(0,0,0,0.5); pointer-events: auto;
            animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; display: flex; align-items: center; gap: 8px;
        }
        .alert-popup.fade-out { opacity: 0; transform: translateY(20px); transition: all 0.5s; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        .loader { border: 3px solid rgba(255,255,255,0.1); border-top: 3px solid var(--accent-primary); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    
    <div id="bg-layer"><div id="bg-anim"></div></div>

    <!-- Loading Screen -->
    <div id="app-loading" class="fixed inset-0 z-[200] bg-black flex flex-col items-center justify-center text-white transition-opacity duration-500">
        <div class="loader mb-6"></div>
        <p class="font-bold tracking-widest animate-pulse text-lg">FC FLIPS PRO</p>
    </div>

    <!-- Header -->
    <header class="bg-[#09090b]/80 backdrop-blur-xl border-b border-white/5">
        <nav class="container mx-auto px-4 py-3 flex items-center justify-between">
            <div class="flex items-center gap-4">
                <h1 class="text-2xl font-extrabold text-white tracking-wider cursor-pointer hover:opacity-80 transition" onclick="window.location.hash = '#/home'">
                    <span class="text-blue-500">FC</span> FLIPS
                </h1>
            </div>
            <div id="nav-auth-container" class="flex items-center gap-3">
                 <!-- Injected via JS -->
            </div>
        </nav>
    </header>

    <!-- Main View -->
    <div id="router-view" class="container mx-auto p-4 md:p-6 lg:p-8 flex-grow flex flex-col relative"></div>

    <!-- Overlays -->
    <div id="modal-container"></div>
    <div id="alert-popup-container"></div>

    <!-- TAX CALCULATOR -->
    <div id="tax-calculator" class="fixed bottom-6 right-6 w-72 minimized cursor-pointer">
        <!-- Header -->
        <div class="flex justify-between items-center bg-[#18181b] p-3 border-b border-white/5 select-none" id="tax-header">
            <div class="flex items-center gap-2">
                <div class="w-2 h-2 rounded-full bg-blue-500 animate-pulse"></div>
                <span class="text-xs font-bold text-blue-400 uppercase tracking-wider">Tax Calculator</span>
            </div>
            <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
        </div>
        <!-- Body -->
        <div class="p-4 space-y-4 bg-[#0a0a0c]">
            <div class="grid grid-cols-2 gap-3">
                <div> 
                    <label class="text-[10px] uppercase font-bold text-gray-500 block mb-1">Buy Price</label> 
                    <input type="text" id="tax-buy" class="tax-input" placeholder="0"> 
                </div>
                <div> 
                    <label class="text-[10px] uppercase font-bold text-gray-500 block mb-1">Sell Price</label> 
                    <input type="text" id="tax-sell" class="tax-input" placeholder="0"> 
                </div>
            </div>
            <div class="pt-3 border-t border-white/5 flex justify-between items-end">
                 <div>
                     <span class="text-[10px] text-gray-500 uppercase block">Net Profit</span>
                     <span class="text-[10px] text-gray-600 block leading-tight">After 5% Tax</span>
                 </div>
                 <input type="text" id="tax-result" class="bg-transparent border-0 text-right font-bold text-2xl text-white w-32 focus:outline-none" readonly value="0">
            </div>
        </div>
    </div>

    <!-- TEMPLATES -->

    <!-- 1. HOME -->
    <template id="home-template">
        <main class="flex-grow flex flex-col items-center justify-center text-center py-20 px-4 fade-in">
            <div class="inline-block px-4 py-1.5 rounded-full bg-blue-500/10 border border-blue-500/20 text-blue-400 text-xs font-bold uppercase tracking-widest mb-6 animate-pulse">Live Trading Deals</div>
            <h1 class="text-5xl md:text-7xl font-extrabold text-white mb-6 tracking-tight">Dominate the <br><span class="text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-cyan-300">Transfer Market</span></h1>
            <p class="text-xl text-gray-400 mb-10 max-w-2xl mx-auto leading-relaxed">Real-time sniper alerts, automated profit calculation, and advanced trading tools.</p>
            <div id="home-cta" class="flex flex-col sm:flex-row gap-4 mb-20 justify-center"></div>

            <section class="w-full grid md:grid-cols-3 gap-8 max-w-6xl mx-auto px-4 text-left">
                <div class="card p-8 hover:bg-white/5 transition">
                    <div class="w-12 h-12 bg-blue-500/20 rounded-lg flex items-center justify-center mb-6 text-blue-400">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-3">Flux Flips</h3>
                    <p class="text-gray-400">Algorithmically detects high volatility cards for rapid buying and selling.</p>
                </div>
                <div class="card p-8 hover:bg-white/5 transition">
                    <div class="w-12 h-12 bg-green-500/20 rounded-lg flex items-center justify-center mb-6 text-green-400">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-3">Profit Tracker</h3>
                    <p class="text-gray-400">Manage your trades in real-time. Track buy prices, set sell targets, and see your P&L.</p>
                </div>
                <div class="card p-8 hover:bg-white/5 transition">
                    <div class="w-12 h-12 bg-purple-500/20 rounded-lg flex items-center justify-center mb-6 text-purple-400">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path></svg>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-3">Sniper Alerts</h3>
                    <p class="text-gray-400">Set custom price targets. We notify you the second a player drops into your buy zone.</p>
                </div>
            </section>
        </main>
    </template>

    <!-- 2. LOGIN -->
    <template id="login-template">
        <div class="w-full max-w-md mx-auto py-20 px-4 fade-in">
            <div class="card p-8">
                <h2 class="text-3xl font-bold text-center text-white mb-2">Welcome Back</h2>
                <p class="text-center text-gray-400 mb-8">Access your dashboard.</p>
                <form id="login-form" class="space-y-5">
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Email</label>
                        <input type="email" id="login-email" class="auth-input" placeholder="you@example.com" required>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Password</label>
                        <input type="password" id="login-password" class="auth-input" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
                    </div>
                    <button type="submit" class="btn w-full py-3">Login</button>
                </form>
                <p class="text-center mt-6 text-gray-400 text-sm">No account? <a href="#/signup" class="text-blue-400 hover:text-white font-bold transition">Sign Up</a></p>
            </div>
        </div>
    </template>

    <!-- 3. SIGNUP -->
    <template id="signup-template">
        <div class="w-full max-w-md mx-auto py-20 px-4 fade-in">
            <div class="card p-8">
                <h2 class="text-3xl font-bold text-center text-white mb-2">Create Account</h2>
                <form id="signup-form" class="space-y-5 mt-8">
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Username</label>
                        <input type="text" id="signup-username" class="auth-input" placeholder="TraderOne" required>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Email</label>
                        <input type="email" id="signup-email" class="auth-input" placeholder="you@example.com" required>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Password</label>
                        <input type="password" id="signup-password" class="auth-input" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
                    </div>
                    <button type="submit" class="btn w-full py-3">Sign Up</button>
                </form>
                <p class="text-center mt-6 text-gray-400 text-sm">Have an account? <a href="#/login" class="text-blue-400 hover:text-white font-bold transition">Login</a></p>
            </div>
        </div>
    </template>

    <!-- 4. DASHBOARD -->
    <template id="dashboard-template">
        <div class="flex flex-col gap-6 fade-in">
            <!-- Control Panel -->
            <div class="card p-6 border-blue-500/20 control-panel-container">
                <div class="flex flex-col lg:flex-row justify-between items-end gap-6">
                    <div class="flex flex-wrap gap-4 w-full lg:w-auto">
                        <!-- Strategy Dropdown -->
                        <div class="w-full sm:w-auto">
                            <label class="block text-[10px] text-gray-500 uppercase mb-1.5 font-bold tracking-widest">Strategy</label>
                            <div class="custom-select-container" id="dropdown-strategy">
                                <div class="custom-select-trigger">
                                    <div class="flex items-center gap-2"><span class="selected-icon"></span><span class="selected-text">Select Strategy...</span></div>
                                    <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                                </div>
                                <div class="custom-select-options">
                                    <div class="custom-option" data-value="fluxflips"><div class="option-icon text-blue-400"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg></div><span>Flux Flips</span></div>
                                    <div class="custom-option" data-value="belowaverageflips"><div class="option-icon text-red-400"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6" /></svg></div><span>Below Average</span></div>
                                    <div class="custom-option" data-value="medianflips"><div class="option-icon text-yellow-400"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg></div><span>Median Flips</span></div>
                                </div>
                            </div>
                        </div>

                        <!-- Tools Dropdown -->
                        <div class="w-full sm:w-auto">
                            <label class="block text-[10px] text-gray-500 uppercase mb-1.5 font-bold tracking-widest">Tools</label>
                            <div class="custom-select-container" id="dropdown-tools">
                                <div class="custom-select-trigger border-blue-500/30 text-blue-400">
                                    <div class="flex items-center gap-2"><span class="selected-icon"></span><span class="selected-text">Select Tool...</span></div>
                                    <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                                </div>
                                <div class="custom-select-options">
                                    <div class="custom-option" data-value="pricechecker"><div class="option-icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></div><span>Price Checker</span></div>
                                    <div class="custom-option" data-value="myalerts"><div class="option-icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path></svg></div><span>My Alerts</span></div>
                                    <div class="custom-option" data-value="portfolio"><div class="option-icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg></div><span>Active Trades</span></div>
                                    <div class="custom-option" data-value="trades"><div class="option-icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div><span>Trade History</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex items-center gap-2">
                         <button id="set-alert-btn" class="btn text-sm py-2">Set Alert</button>
                         <button id="highlight-mode-btn" class="btn btn-secondary text-sm py-2">Highlights</button>
                    </div>
                </div>
            </div>

            <!-- Content Area -->
            <main id="tab-content" class="min-h-[500px] content-grid-container pb-24">
                
                <!-- GRID VIEW (DEFAULT) -->
                <div id="grid-view-container" class="hidden">
                    <div class="flex justify-between items-center mb-4">
                        <h3 id="section-title" class="font-bold text-2xl text-white flex items-center gap-2"></h3>
                        <div class="flex gap-2">
                            <button class="toggle-filter-btn text-blue-400 text-sm font-bold hover:text-white transition">Filters</button>
                        </div>
                    </div>
                    <div id="filter-body" class="card p-4 hidden mb-6 border-l-4 border-blue-500">
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <input type="search" id="filter-search" class="filter-input" placeholder="Search Player...">
                            <input type="text" id="filter-min-price" class="filter-input" placeholder="Min Price">
                            <select id="filter-sort" class="filter-input"><option value="newest">ðŸ•’ Newest</option><option value="profit">ðŸ’° Profit</option></select>
                        </div>
                        <div class="mt-4 pt-4 border-t border-white/5">
                            <label class="text-xs font-bold text-gray-500 uppercase mb-2 block">Min Profit: <span class="profit-value-display text-white">3,000</span></label>
                            <input type="range" id="filter-profit-slider" min="1000" max="100000" step="1000" value="3000" class="w-full accent-blue-500 slider-input">
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="deals-grid"></div>
                </div>

                <!-- PRICE CHECKER -->
                <div id="pricechecker" class="tab-pane hidden">
                    <div class="max-w-3xl mx-auto">
                         <div class="card p-10 text-center mb-8">
                             <h2 class="text-3xl font-bold text-white mb-2">Price Checker</h2>
                             <p class="text-gray-400 mb-8">Search the live database for real-time market data.</p>
                             <div class="relative max-w-lg mx-auto">
                                 <input type="text" id="pc-search-input" class="modern-input py-4 px-6 rounded-full text-lg shadow-xl" placeholder="Type player name (e.g. Mbappe)...">
                                 <div class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-500">
                                     <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                                 </div>
                             </div>
                         </div>
                         <div id="pc-results" class="grid grid-cols-1 gap-6"></div>
                    </div>
                </div>

                <!-- ALERTS -->
                <div id="myalerts" class="tab-pane hidden">
                      <h3 class="font-bold text-2xl text-white mb-6">Active Alerts</h3>
                      <div class="card overflow-hidden">
                        <table class="w-full text-left"><thead class="bg-black/30 text-xs text-gray-500"><tr><th class="p-4">Player</th><th class="p-4">Target</th><th class="p-4 text-right">Action</th></tr></thead>
                        <tbody id="my-alerts-table" class="divide-y divide-white/5 text-gray-300"><tr><td colspan="3" class="p-6 text-center text-gray-500">No alerts set.</td></tr></tbody></table>
                      </div>
                </div>

                <!-- PORTFOLIO -->
                <div id="portfolio" class="tab-pane hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="font-bold text-2xl text-white">Active Trades</h3>
                        <button id="add-trade-btn" class="btn text-sm">Add Card</button>
                    </div>
                    <div class="card overflow-hidden">
                        <table class="w-full text-left text-sm text-gray-300">
                            <thead class="bg-black/30 text-xs text-gray-500 uppercase">
                                <tr><th class="p-4">Player</th><th class="p-4">Buy Price</th><th class="p-4">Current</th><th class="p-4">P/L</th><th class="p-4 text-right">Action</th></tr>
                            </thead>
                            <tbody id="portfolio-table" class="divide-y divide-white/5"></tbody>
                        </table>
                    </div>
                </div>

                <!-- HISTORY -->
                <div id="trades" class="tab-pane hidden">
                    <h3 class="font-bold text-2xl text-white mb-6">Trade History</h3>
                    <div class="card overflow-hidden">
                        <table class="w-full text-left text-sm text-gray-300">
                            <thead class="bg-black/30 text-xs text-gray-500 uppercase">
                                <tr><th class="p-4">Player</th><th class="p-4">Buy</th><th class="p-4">Sell</th><th class="p-4">Profit</th></tr>
                            </thead>
                            <tbody id="history-table" class="divide-y divide-white/5"></tbody>
                        </table>
                    </div>
                </div>
                
                <!-- WELCOME MSG -->
                <div id="welcome-message" class="text-center py-20 opacity-50">
                    <svg class="w-20 h-20 mx-auto mb-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                    <h2 class="text-2xl font-bold text-white mb-2">Ready to Trade?</h2>
                    <p class="text-gray-400">Select a strategy above to load the feed.</p>
                </div>

            </main>
        </div>
    </template>

    <!-- 5. SETTINGS -->
    <template id="settings-template">
        <div class="max-w-2xl mx-auto py-10 px-4 fade-in">
            <h1 class="text-3xl font-bold text-white mb-8">Account Settings</h1>
            <div class="card p-8 mb-8">
                <h2 class="text-xl font-bold text-blue-400 mb-4">Profile</h2>
                <form id="profile-form" class="space-y-4">
                    <div>
                        <label class="text-xs font-bold text-gray-500 uppercase">Username</label>
                        <input type="text" class="auth-input mt-1" value="TraderOne">
                    </div>
                    <button type="submit" class="btn">Update Profile</button>
                </form>
            </div>
            <div class="card p-8 mb-8">
                <h2 class="text-xl font-bold text-blue-400 mb-4">Subscription</h2>
                <p class="text-gray-400 mb-4">Current Plan: <span class="text-green-400 font-bold">PRO</span></p>
                <button class="btn btn-secondary" onclick="window.handleSub()">Manage Subscription</button>
            </div>
        </div>
    </template>

    <!-- 6. ADMIN -->
    <template id="admin-template">
        <div class="max-w-6xl mx-auto py-10 px-4 fade-in">
            <h1 class="text-3xl font-bold text-white mb-8">Admin Console</h1>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="card p-6 h-fit">
                    <h2 class="text-xl font-bold text-blue-400 mb-4">Site Config</h2>
                    <form id="site-config" class="space-y-4">
                        <div>
                            <label class="text-xs font-bold text-gray-500 uppercase">Broadcast</label>
                            <input type="text" class="auth-input mt-1" placeholder="Broadcast Message">
                        </div>
                        <div class="flex items-center gap-2 bg-white/5 p-2 rounded border border-white/5">
                            <input type="checkbox" class="accent-blue-500 w-4 h-4"> 
                            <span class="text-gray-300 text-sm">Maintenance Mode</span>
                        </div>
                        <button class="btn w-full">Save Config</button>
                    </form>
                </div>
                <div class="card p-6 lg:col-span-2">
                    <h2 class="text-xl font-bold text-blue-400 mb-4">User Management</h2>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-sm text-gray-300">
                            <thead class="bg-black/20 text-gray-500 uppercase text-xs font-bold">
                                <tr><th class="p-3">User</th><th class="p-3">Email</th><th class="p-3">Status</th><th class="p-3 text-right">Action</th></tr>
                            </thead>
                            <tbody class="divide-y divide-white/5">
                                <tr class="hover:bg-white/5">
                                    <td class="p-3 font-bold text-white">TraderOne</td>
                                    <td class="p-3 text-gray-400">user@test.com</td>
                                    <td class="p-3 text-green-400 font-bold">Active</td>
                                    <td class="p-3 text-right"><button class="text-xs bg-red-500/20 text-red-400 px-3 py-1 rounded hover:bg-red-500 hover:text-white transition">Ban</button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFunctions, httpsCallable } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-functions.js";

        // CONFIG
        const firebaseConfig = { apiKey: "DEMO_MODE", authDomain: "snipes-cfb.firebaseapp.com", projectId: "snipes-cfb" };
        
        let userId = null;
        let app, auth;
        
        // GLOBAL STATE
        let state = {
            activeView: null, // fluxflips, belowaverageflips, medianflips, pricechecker, myalerts, portfolio, trades
            mockData: [],
            trades: [],
            history: [],
            alerts: [],
            filters: { search: '', minProfit: 3000, sort: 'newest' }
        };

        const players = ['Mbappe', 'Haaland', 'Vinicius', 'Bellingham', 'Putellas', 'Hansen', 'Rodri', 'De Bruyne', 'Bonmati', 'Salah', 'Kane', 'Son', 'Neymar', 'Messi', 'Ronaldo', 'Saka', 'Rashford', 'Leao'];

        // --- HELPERS ---
        const el = (id) => document.getElementById(id);
        const formatNum = (n) => n ? Number(n).toLocaleString() : '0';
        
        const showToast = (message) => {
            const container = el('alert-popup-container');
            const toast = document.createElement('div');
            toast.className = 'alert-popup';
            toast.innerHTML = `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg><span>${message}</span>`;
            container.appendChild(toast);
            setTimeout(() => { toast.classList.add('fade-out'); setTimeout(() => toast.remove(), 500); }, 3000);
        };

        const openModal = (title, contentHTML, onConfirm) => {
            const container = el('modal-container');
            container.innerHTML = `
            <div class="modal-backdrop" id="active-modal-backdrop">
                <div class="modal-content">
                    <h2 class="text-2xl font-bold text-white mb-4">${title}</h2>
                    <div class="mb-6 space-y-4 text-gray-300">${contentHTML}</div>
                    <div class="flex justify-end gap-3">
                        <button id="modal-cancel-btn" class="btn btn-secondary">Cancel</button>
                        <button id="modal-confirm-btn" class="btn">Save</button>
                    </div>
                </div>
            </div>`;
            el('modal-cancel-btn').addEventListener('click', () => container.innerHTML = '');
            el('active-modal-backdrop').addEventListener('click', (e) => { if(e.target===e.currentTarget) container.innerHTML = ''; });
            el('modal-confirm-btn').addEventListener('click', () => { if(onConfirm) onConfirm(); container.innerHTML = ''; });
        };

        // --- LOGIC: MOCK DATA ---
        function generateMockCard(type) {
            const basePrice = Math.floor(Math.random() * 800000) + 15000;
            const profit = Math.floor(Math.random() * 50000) + 2000;
            return {
                id: Math.random().toString(36).substr(2,9),
                name: players[Math.floor(Math.random() * players.length)],
                price: basePrice,
                profit: profit,
                sell: Math.floor((basePrice + profit) / 0.95),
                timestamp: Date.now(),
                type: type
            };
        }

        // --- LOGIC: RENDERERS ---
        function renderGrid() {
            const grid = el('deals-grid');
            if(!grid) return;
            
            // Filter
            let displayData = state.mockData.filter(d => d.type === state.activeView);
            displayData = displayData.filter(d => d.profit >= state.filters.minProfit);
            if(state.filters.search) displayData = displayData.filter(d => d.name.toLowerCase().includes(state.filters.search.toLowerCase()));
            
            // Sort
            if(state.filters.sort === 'profit') displayData.sort((a,b) => b.profit - a.profit);
            else displayData.sort((a,b) => b.timestamp - a.timestamp);

            if(displayData.length === 0) {
                grid.innerHTML = `<div class="col-span-full text-center py-20 text-gray-500">Waiting for live data...</div>`;
                return;
            }

            grid.innerHTML = displayData.map(item => `
            <div class="deal-card card group ${item.profit > 15000 ? 'highlighted-card' : ''}">
                <button class="absolute top-2 right-2 z-20 text-red-500 opacity-0 group-hover:opacity-100 transition"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"/></svg></button>
                <div class="relative bg-gradient-to-b from-[#1f2937] to-[var(--bg-dark)] p-6 flex justify-center border-b border-white/5">
                    <img src="https://fut.gg/assets/img/players/default.png" class="w-24 h-24 object-contain opacity-80 group-hover:scale-110 transition duration-300">
                </div>
                <div class="p-5 flex-grow flex flex-col bg-[#18181b]">
                    <h3 class="text-center text-lg font-bold text-white truncate mb-4">${item.name}</h3>
                    <div class="grid grid-cols-2 gap-2 text-center mb-4">
                        <div class="bg-white/5 p-2 rounded border border-white/5"><div class="text-[10px] text-gray-500 uppercase font-bold">Buy</div><div class="text-lg font-bold text-white">${formatNum(item.price)}</div></div>
                        <div class="bg-white/5 p-2 rounded border border-white/5"><div class="text-[10px] text-gray-500 uppercase font-bold">Target</div><div class="text-lg font-bold text-blue-400">${formatNum(item.sell)}</div></div>
                    </div>
                    <div class="mt-auto pt-3 border-t border-white/5 flex justify-between items-center">
                        <span class="text-xs font-bold text-gray-500 uppercase">Profit</span>
                        <span class="text-2xl font-bold profit-positive">${formatNum(item.profit)}</span>
                    </div>
                    <button class="btn btn-secondary w-full mt-3 text-xs py-2" onclick="window.addToPortfolio(${item.id})">Add to Trades</button>
                </div>
            </div>`).join('');
        }

        window.addToPortfolio = (id) => {
            const item = state.mockData.find(i => i.id == id || i.id === id); // loose match for mock IDs
            if(item) {
                state.trades.push({...item, buyPrice: item.price, qty: 1});
                showToast("Added to Active Trades");
            }
        };

        function renderPortfolio() {
            const tbody = el('portfolio-table');
            if(!tbody) return;
            if(state.trades.length === 0) { tbody.innerHTML = `<tr><td colspan="5" class="p-6 text-center text-gray-500">No active trades.</td></tr>`; return; }
            tbody.innerHTML = state.trades.map((t, i) => {
                const currentVal = Math.floor(t.price * (1 + (Math.random() * 0.1 - 0.05)));
                const pl = (currentVal * 0.95 - t.buyPrice) * t.qty;
                return `
                <tr class="hover:bg-white/5">
                    <td class="p-4 font-bold text-white">${t.name}</td>
                    <td class="p-4 text-gray-300">${formatNum(t.buyPrice)}</td>
                    <td class="p-4 text-gray-300">${formatNum(currentVal)}</td>
                    <td class="p-4 font-bold ${pl >= 0 ? 'profit-positive' : 'loss-negative'}">${formatNum(pl)}</td>
                    <td class="p-4 text-right"><button class="text-xs btn-secondary px-2 py-1 rounded" onclick="window.sellTrade(${i}, ${currentVal})">Sell</button></td>
                </tr>`;
            }).join('');
        }

        window.sellTrade = (index, sellPrice) => {
            const t = state.trades[index];
            const profit = (sellPrice * 0.95 - t.buyPrice) * t.qty;
            state.history.push({...t, sellPrice, profit, soldAt: Date.now()});
            state.trades.splice(index, 1);
            renderPortfolio();
            showToast(`Sold! Profit: ${formatNum(profit)}`);
        };

        function renderHistory() {
            const tbody = el('history-table');
            if(!tbody) return;
            if(state.history.length === 0) { tbody.innerHTML = `<tr><td colspan="4" class="p-6 text-center text-gray-500">No trade history yet.</td></tr>`; return; }
            tbody.innerHTML = state.history.map(t => `
                <tr>
                    <td class="p-4">${t.name}</td>
                    <td class="p-4">${formatNum(t.buyPrice)}</td>
                    <td class="p-4">${formatNum(t.sellPrice)}</td>
                    <td class="p-4 font-bold ${t.profit >= 0 ? 'profit-positive' : 'loss-negative'}">${formatNum(t.profit)}</td>
                </tr>
            `).join('');
        }

        window.handleSub = () => {
             showToast("Opening Billing Portal...");
             setTimeout(() => showToast("Redirected (Mock)"), 1500);
        };

        // --- DASHBOARD INIT ---
        function initDashboard() {
            // Dropdowns
            setupCustomDropdown('dropdown-strategy', (val) => {
                state.activeView = val;
                showTab('grid-view-container');
                
                const titles = { fluxflips: 'ðŸŒŠ Flux Flips', belowaverageflips: 'ðŸ“‰ Below Average', medianflips: 'âš¡ Median Flips' };
                const titleEl = el('section-title');
                if(titleEl) titleEl.innerHTML = `${titles[val]} <span class="text-xs font-normal text-gray-500 ml-2 bg-black/30 px-2 py-1 rounded animate-pulse">Live</span>`;
                
                renderGrid();
            });

            setupCustomDropdown('dropdown-tools', (val) => {
                showTab(val);
                if(val === 'portfolio') renderPortfolio();
                if(val === 'trades') renderHistory();
            });

            // Filters
            el('filter-search')?.addEventListener('input', (e) => { state.filters.search = e.target.value; renderGrid(); });
            el('filter-profit-slider')?.addEventListener('input', (e) => { 
                state.filters.minProfit = e.target.value; 
                const disp = document.querySelector('.profit-value-display');
                if(disp) disp.textContent = formatNum(e.target.value);
                renderGrid();
            });

            // Price Checker Logic
            el('pc-search-input')?.addEventListener('keyup', (e) => {
                if(e.key === 'Enter') {
                    const val = e.target.value.toUpperCase();
                    el('pc-results').innerHTML = `
                    <div class="card p-6 flex flex-col items-center animate-pulse">
                        <h3 class="font-bold text-xl text-white mb-2">${val}</h3>
                        <p class="text-3xl font-bold text-blue-400">1,250,000</p>
                        <p class="text-xs text-gray-500 mt-2">Lowest BIN</p>
                        <div class="mt-4 w-full grid grid-cols-2 gap-4 text-center">
                             <div class="bg-white/5 p-2 rounded"><div class="text-[10px] uppercase text-gray-500">Sell At</div><div class="text-green-400 font-bold">1.35M</div></div>
                             <div class="bg-white/5 p-2 rounded"><div class="text-[10px] uppercase text-gray-500">Safe Buy</div><div class="text-white font-bold">1.1M</div></div>
                        </div>
                    </div>`;
                }
            });

            // Tax Calc Logic
            el('tax-header').addEventListener('click', () => el('tax-calculator').classList.toggle('minimized'));
            ['tax-buy', 'tax-sell'].forEach(id => el(id).addEventListener('input', handleTaxInput));

            // Start Mock Loop
            setInterval(() => {
                if(['fluxflips', 'belowaverageflips', 'medianflips'].includes(state.activeView)) {
                    state.mockData.unshift(generateMockCard(state.activeView));
                    if(state.mockData.length > 50) state.mockData.pop();
                    renderGrid();
                }
            }, 3000);
        }

        // --- UTILS ---
        function setupCustomDropdown(id, callback) {
            const container = el(id);
            if(!container) return;
            const trigger = container.querySelector('.custom-select-trigger');
            
            trigger.addEventListener('click', (e) => {
                e.stopPropagation();
                document.querySelectorAll('.custom-select-container').forEach(c => { if(c!==container) c.classList.remove('open'); });
                container.classList.toggle('open');
            });

            container.querySelectorAll('.custom-option').forEach(opt => {
                opt.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const val = opt.dataset.value;
                    container.querySelector('.selected-text').textContent = opt.querySelector('span:last-child').textContent;
                    const icon = opt.querySelector('.option-icon').innerHTML;
                    container.querySelector('.selected-icon').innerHTML = icon;
                    container.classList.remove('open');
                    callback(val);
                });
            });
            document.addEventListener('click', () => container.classList.remove('open'));
        }

        function showTab(id) {
            document.querySelectorAll('.tab-pane').forEach(t => t.classList.add('hidden'));
            const gridCont = el('grid-view-container');
            const welcome = el('welcome-message');
            
            if(gridCont) gridCont.classList.add('hidden');
            if(welcome) welcome.classList.add('hidden');
            
            if(id === 'grid-view-container') {
                if(gridCont) gridCont.classList.remove('hidden');
            } else {
                const target = el(id);
                if(target) target.classList.remove('hidden');
            }
        }

        function handleTaxInput() {
            const buyVal = el('tax-buy').value.replace(/,/g, '').replace(/\D/g, '');
            const sellVal = el('tax-sell').value.replace(/,/g, '').replace(/\D/g, '');
            
            el('tax-buy').value = buyVal ? parseInt(buyVal).toLocaleString() : '';
            el('tax-sell').value = sellVal ? parseInt(sellVal).toLocaleString() : '';

            const b = parseInt(buyVal) || 0;
            const s = parseInt(sellVal) || 0;

            if(b && s) {
                const p = Math.round((s*0.95)-b);
                const r = el('tax-result');
                r.value = p.toLocaleString();
                r.style.color = p >= 0 ? '#22c55e' : '#ef4444';
            }
        }

        // --- INIT ---
        const router = () => {
            const path = window.location.hash || '#/home';
            const view = el('router-view');
            const templates = {
                '#/home': 'home-template',
                '#/login': 'login-template',
                '#/signup': 'signup-template',
                '#/dashboard': 'dashboard-template',
                '#/settings': 'settings-template',
                '#/admin': 'admin-template'
            };

            // Auth Guard
            if(['#/dashboard', '#/settings', '#/admin'].includes(path) && !userId) {
                showToast("Please login first");
                window.location.hash = '#/login';
                return;
            }

            const tmpl = templates[path] || 'home-template';
            view.innerHTML = el(tmpl).innerHTML;

            if(path === '#/dashboard') {
                el('tax-calculator').classList.remove('hidden');
                // Seed initial data
                ['fluxflips', 'belowaverageflips', 'medianflips'].forEach(t => {
                    for(let i=0; i<5; i++) state.mockData.push(generateMockCard(t));
                });
                initDashboard();
            } else {
                el('tax-calculator').classList.add('hidden');
            }

            if(['#/login', '#/signup'].includes(path)) {
                const formId = path === '#/login' ? 'login-form' : 'signup-form';
                el(formId).addEventListener('submit', (e) => {
                    e.preventDefault();
                    userId = 'user_123';
                    updateNav();
                    window.location.hash = '#/dashboard';
                    showToast("Welcome!");
                });
            }
            
            if(path === '#/home' && userId) {
                el('home-cta').innerHTML = `<a href="#/dashboard" class="btn text-lg py-3 px-8 shadow-xl">Launch Dashboard</a>`;
            } else if(path === '#/home') {
                el('home-cta').innerHTML = `<a href="#/signup" class="btn text-lg py-3 px-8 shadow-xl">Get Started</a> <a href="#/login" class="btn btn-secondary text-lg py-3 px-8">Login</a>`;
            }
        };

        // Fix for button event delegation
        document.addEventListener('click', (e) => {
            if(e.target.id === 'set-alert-btn') {
                openModal('Set Price Alert', `<div><label class="text-xs font-bold text-gray-500">Player</label><input class="auth-input mt-1" placeholder="Mbappe"></div><div><label class="text-xs font-bold text-gray-500">Max Price</label><input class="auth-input mt-1" placeholder="1,000,000"></div>`, () => showToast("Alert Set"));
            }
            if(e.target.id === 'highlight-mode-btn') {
                openModal('Visual Settings', `<div><label class="text-xs font-bold text-gray-500">Profit Threshold</label><input class="auth-input mt-1" value="10,000"></div>`, () => showToast("Settings Saved"));
            }
            if(e.target.classList.contains('toggle-filter-btn')) {
                const fb = el('filter-body');
                if(fb) fb.classList.toggle('hidden');
            }
            if(e.target.id === 'add-trade-btn') {
                openModal('Add Manual Trade', `<div><label class="text-xs font-bold text-gray-500">Player</label><input class="auth-input mt-1"></div>`, () => showToast("Trade Added"));
            }
            
            // Profile Dropdown Toggle Logic
            if(e.target.closest('.profile-dropdown-container button')) {
                const menu = document.querySelector('.profile-dropdown-menu');
                if(menu) menu.classList.toggle('active');
            } else if(!e.target.closest('.profile-dropdown-menu')) {
                 const menu = document.querySelector('.profile-dropdown-menu');
                 if(menu) menu.classList.remove('active');
            }
        });

        function updateNav() {
            const nav = el('nav-auth-container');
            if(userId) {
                nav.innerHTML = `
                <div class="relative profile-dropdown-container">
                    <button class="w-10 h-10 rounded-full bg-blue-600 flex items-center justify-center text-white font-bold text-sm cursor-pointer shadow-lg border border-blue-400/30">U</button>
                    <div class="profile-dropdown-menu">
                        <div class="px-4 py-3 border-b border-white/5"><p class="text-xs text-gray-400">Signed in as</p><p class="text-sm font-bold text-white truncate">TraderOne</p></div>
                        <a href="#/dashboard" class="block px-4 py-2 text-sm text-gray-300 hover:bg-blue-500/10 hover:text-blue-400 transition">Dashboard</a>
                        <a href="#/settings" class="block px-4 py-2 text-sm text-gray-300 hover:bg-blue-500/10 hover:text-blue-400 transition">Settings</a>
                        <button onclick="window.handleSub()" class="block w-full text-left px-4 py-2 text-sm text-gray-300 hover:bg-blue-500/10 hover:text-blue-400 transition">Manage Subscription</button>
                        <a href="#/admin" class="block px-4 py-2 text-sm text-red-400 hover:bg-red-500/10 transition">Admin Panel</a>
                        <button id="logout-btn" class="block w-full text-left px-4 py-2 text-sm text-gray-300 hover:bg-white/5 transition">Logout</button>
                    </div>
                </div>`;
                el('logout-btn').addEventListener('click', () => { userId = null; showToast("Logged Out"); updateNav(); window.location.hash = '#/home'; });
            } else {
                nav.innerHTML = `<a href="#/login" class="text-sm font-medium text-gray-300 hover:text-white mr-2">Login</a><a href="#/signup" class="btn text-sm py-1.5 px-4">Sign Up</a>`;
            }
        }

        window.addEventListener('hashchange', router);
        window.addEventListener('load', () => {
            try { app = initializeApp(firebaseConfig); auth = getAuth(app); onAuthStateChanged(auth, u => { userId = u ? u.uid : null; updateNav(); }); } catch(e) {}
            setTimeout(() => el('app-loading').classList.add('hidden'), 800);
            router(); updateNav();
        });

    </script>
</body>
</html>
